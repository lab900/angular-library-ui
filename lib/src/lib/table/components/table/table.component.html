<div class="lab900-table {{ tableClass }}" *ngIf="tableCells?.length">
  <lab900-table-header
    [tableHeaderActions]="tableHeaderActions"
    [tableCells]="tableCells"
    [toggleColumns]="toggleColumns"
    [toggleAndMoveColumns]="toggleAndMoveColumns"
    (tableCellsFiltered)="onTableCellsFiltered($event)"
    [filterIcon]="filterIcon"
  >
    <ng-container *ngIf="tableHeaderContent">
      <ng-container *ngTemplateOutlet="tableHeaderContent"></ng-container>
    </ng-container>
  </lab900-table-header>

  <ng-container *ngIf="tableTopContent">
    <ng-container *ngTemplateOutlet="tableTopContent"></ng-container>
  </ng-container>

  <lab900-table-tabs
    *ngIf="tableTabs?.length"
    [tableTabs]="tableTabs"
    [activeTabId]="activeTabId || tableTabs[0].id"
    (activeTabIdChange)="onActiveTabChange($event)"
  ></lab900-table-tabs>

  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <div class="lab900-table-wrapper">
    <table
      mat-table
      cdkDropList
      [cdkDropListDisabled]="!draggableRows"
      class="mat-elevation-z0"
      *ngIf="(data?.length || neverHideTable) && !disabled"
      multiTemplateDataRows
      [dataSource]="data"
      (cdkDropListDropped)="tableRowOrderChange.emit($event)"
    >
      >
      <ng-container
        matColumnDef="select"
        [sticky]="selectableRowsOptions?.position === 'left' && selectableRowsOptions.sticky"
        [stickyEnd]="selectableRowsOptions?.position === 'right' && selectableRowsOptions.sticky"
      >
        <th mat-header-cell *matHeaderCellDef class="checkbox-cell" (click)="$event.stopPropagation()">
          <mat-checkbox
            #selectAllCheckbox
            *ngIf="selectableRowsOptions?.showSelectAllCheckbox"
            [color]="selectableRowsOptions?.checkBoxColor ? selectableRowsOptions.checkBoxColor : 'primary'"
            (change)="handleSelectAllCheckbox($event)"
          ></mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row" class="checkbox-cell" (click)="$event.stopPropagation()">
          <ng-container *ngIf="!hideSelectableCheckbox(row)">
            <mat-checkbox
              #rowCheckbox
              [color]="selectableRowsOptions?.checkBoxColor ? selectableRowsOptions.checkBoxColor : 'primary'"
              (change)="selectRow(row)"
              [checked]="selection.isSelected(row)"
              [disabled]="selection.isSelected(row) ? false : !selectEnabled"
            ></mat-checkbox>
          </ng-container>
        </td>

        <ng-container *ngIf="showCellFooters">
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>
      </ng-container>

      <lab900-table-cell
        *ngFor="let cell of tableCells; trackBy: trackCellFn"
        [cell]="cell"
        [sort]="sort"
        [maxColumnWidthFromTable]="maxColumnWidth"
        [customCellContent]="customCellContent"
        [customHeaderCell]="customHeaderCell"
        (headerClick)="handleHeaderClick($event)"
        [data]="data"
      ></lab900-table-cell>

      <ng-content select=".lab900-table-cell"></ng-content>

      <ng-container *ngIf="preFooterTitle">
        <ng-container matColumnDef="preFooterTitle">
          <td mat-footer-cell *matFooterCellDef [attr.colspan]="tableCells.length + 1" class="lab900-table__pre-footer-title-cell">
            {{ preFooterTitle | translate }}
          </td>
        </ng-container>
      </ng-container>

      <ng-container matColumnDef="actions-front">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element" (click)="$event.stopPropagation()">
          <div style="width: 100%" fxLayout="row" fxLayoutGap="8" fxLayoutAlign="start center" *ngIf="tableActionsFront?.length">
            <lab900-action-button
              *ngFor="let action of tableActionsFront"
              [data]="element"
              [action]="action"
              cdkDragHandle
              [cdkDragHandleDisabled]="!action?.draggable"
            ></lab900-action-button>
          </div>
        </td>
        <ng-container *ngIf="showCellFooters">
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>
      </ng-container>

      <ng-container matColumnDef="actions-back" stickyEnd>
        <th mat-header-cell *matHeaderCellDef></th>
        <td style="width: 0" mat-cell *matCellDef="let element" (click)="$event.stopPropagation()">
          <div style="width: 100%" fxLayout="row" fxLayoutGap="8" fxLayoutAlign="end center" *ngIf="tableActionsBack?.length">
            <lab900-action-button
              *ngFor="let action of tableActionsBack"
              [data]="element"
              [action]="action"
              cdkDragHandle
              [cdkDragHandleDisabled]="!action?.draggable"
            ></lab900-action-button>
          </div>
        </td>
        <ng-container *ngIf="showCellFooters">
          <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns; let i = dataIndex"
        [ngClass]="getRowClasses(row, i)"
        (click)="handleRowClick($event, row, i)"
        cdkDrag
        [cdkDragDisabled]="!draggableRows"
      ></tr>
      <ng-container *ngIf="preFooterTitle && data?.length">
        <tr mat-footer-row *matFooterRowDef="['preFooterTitle']" class="lab900-table__pre-footer-title-row"></tr>
      </ng-container>
      <ng-container *ngIf="showCellFooters && data?.length">
        <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
      </ng-container>
      <ng-container *ngIf="draggableRows">
        <div *cdkDragPlaceholder></div>
      </ng-container>
    </table>
  </div>

  <div class="lab900-table__empty" *ngIf="data && !data.length && !disabled">
    <ng-container *ngIf="emptyTableTemplate">
      <ng-container *ngTemplateOutlet="emptyTableTemplate"></ng-container>
    </ng-container>
    <ng-container *ngIf="!emptyTableTemplate">
      <h3>{{ 'GENERAL.NO_RESULTS.TITLE' | translate }}</h3>
      <p>{{ 'GENERAL.NO_RESULTS.DESC' | translate }}</p>
    </ng-container>
  </div>

  <div
    class="lab900-table__footer"
    [class.left-content]="footerLeftContent"
    *ngIf="footerLeftContent || tableFooterActions?.length || (data?.length && paging)"
  >
    <div class="lab900-table__footer__left" *ngIf="footerLeftContent">
      <ng-container *ngTemplateOutlet="footerLeftContent"></ng-container>
    </div>
    <div class="lab900-table__footer__right">
      <div>
        <div class="lab900-table__footer__actions" *ngIf="tableFooterActions?.length">
          <lab900-action-button *ngFor="let action of tableFooterActions" [action]="action"></lab900-action-button>
        </div>
      </div>
      <mat-paginator
        *ngIf="data?.length && paging"
        [hidePageSize]="pageSizeConfig.hidePageSize"
        [pageSizeOptions]="pageSizeConfig.pageSizeOptions"
        [length]="paging.totalItems"
        [pageSize]="paging.pageSize"
        [pageIndex]="paging.pageIndex"
        (page)="pageChange.emit($event)"
      ></mat-paginator>
    </div>
  </div>

  <div *ngIf="disabled">
    <ng-container *ngIf="disabledTableTemplate">
      <ng-container *ngTemplateOutlet="disabledTableTemplate"></ng-container>
    </ng-container>
    <ng-container *ngIf="!disabledTableTemplate">
      <h3>{{ 'GENERAL.DISABLED.TITLE' | translate }}</h3>
      <p>{{ 'GENERAL.DISABLED.DESC' | translate }}</p>
    </ng-container>
  </div>
</div>
